<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="app.css" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Medicine Insert</title>
    </head>
    <body>
        <div class="insert-main-container">
            <div class="insert-container">
                <input type="text" placeholder="Name" id="name" name="name" required />
                <input type="text" placeholder="Species" id="species" name="species" required />
                <input type="text" placeholder="Dose, Frequency, Route" id="dose" name="dose" required />
                <textarea name="remarks" id="remarks" placeholder="Remarks"></textarea>
                <div class="form-btn-container">
                    <button class="btn secondary" onclick="location.href='../index.html'">Back</button>
                    <button id="submit-button" class="btn primary">Submit</button>
                </div>
            </div>
        </div>

        <script>
            document.getElementById('submit-button').addEventListener('click', function (event) {
                event.preventDefault() // Prevent the default form submission

                let valid = true
                const inputs = document.querySelectorAll('input')
                inputs.forEach((input) => {
                    if (input.value.trim() === '') {
                        valid = false
                    }
                })

                if (!valid) {
                    alert('Please fill out all the fields.')
                    return
                }

                const data = {
                    name: document.getElementById('name').value,
                    species: document.getElementById('species').value,
                    dose: document.getElementById('dose').value,
                    remarks: document.getElementById('remarks').value,
                }

                fetch('http://localhost:3000/medicine', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                    .then((response) => {
                        console.log(response)
                        if (!response.ok) {
                            return response.text().then((text) => {
                                throw new Error(text)
                            })
                        }
                        return response.text()
                    })
                    .then((message) => {
                        alert(message)
                        document.querySelectorAll('input').forEach((input) => (input.value = '')) // Clear form
                    })
                    .catch((error) => {
                        console.error('Error:', error)
                        alert('Error inserting data: ' + error.message)
                    })
            })
        </script>
    </body>
</html>
